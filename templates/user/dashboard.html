{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="./logo.png" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static './css/dashboard.css' %}" />
  <script src="https://kit.fontawesome.com/883ba9c28f.js" crossorigin="anonymous"></script>
  <script src="{% static './js/mood.js' %}"></script>
  <script src="{% static './js/menu.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Blakdhut Exchange</title>
</head>
<body>
<header class="navbar">
  <a href="{% url 'user:dashboard' %}" class="logo">
    <img src="{% static './logo.png' %}" alt="Blakdhut Logo" />
  </a>
  <button class="menu-toggle" id="menuToggle">&#9776;</button>

  <div class="overlay" id="menu">
    <button class="close-btn" id="closeMenu">&times;</button>
    <nav class="overlay-menu">
      <a href="{% url 'user:profile' %}">Profile</a>
      <a href="./kyc">KYC</a>
      <a href="./referral">Referral</a>
      <a href="{% url 'user:history' %}">History</a>
      <a href="./support">Support</a>
      <a href="{% url 'user:logout' %}">Sign Out</a>
      <button id="theme-toggle" class="menu-toggle"><i class="fa-solid fa-moon fa-2xs"></i></button>
    </nav>
  </div>
</header>

<div class="container mt-3">
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-center" role="alert" style="max-width: 400px; margin: auto;">
        <strong>{{ message }}</strong>
      </div>
    {% endfor %}
  {% endif %}
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach((alert) => {
      setTimeout(() => {
        let bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
        bsAlert.close();
      }, 5000);
    });
  });
</script>

<main class="content">
    <h2>Hello, {{ request.user.username }} ðŸ‘‹</h2>
    <div class="actions">
      <div class="act">
        <div class="action-item">
          <a href="./sell.html">
            <button><img src="{% static './icons/up.png' %}" alt="Sell" /></button>
          </a>
          <span>Sell</span>
        </div>
        <div class="action-item">
          <a href="{% url 'user:buy' %}">
          <button><img src="{% static './icons/down.png' %}" alt="Buy" /></button>
          </a>
          <span>Buy</span>
        </div>
        <div class="action-item">
          <a href="{% url 'user:comingsoon' %}">
          <button><img src="{% static './icons/swap.png' %}" alt="Buy" /></button>
          </a>
          <span>Swap</span>
        </div>
        <div class="action-item">
          <a href="{% url 'user:history' %}">
          <button><img src="{% static './icons/bill.png' %}" alt="History" /></button>
          </a>
          <span>History</span>
        </div>
      </div>
    </div>
  </main>

  <div class="wallet-container">
    <div id="wallet-list" class="wallet-list">
      <div class="loading">Loading...</div>
    </div>
  </div>



  <footer>
    <small>&copy; 2025 Blakdhut Exchange. All rights reserved.</small>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const walletList = document.getElementById("wallet-list");

  async function fetchCoins() {
      const res = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=6&page=1");
      const data = await res.json();
      renderWallet(data);
  }

  function renderWallet(coins) {
    walletList.innerHTML = "";
    coins.forEach(coin => {
      const changeClass = coin.price_change_percentage_24h > 0 ? "change-up" : "change-down";
      const item = document.createElement("div");
      item.className = "wallet-item";
      item.innerHTML = `
        <div class="asset-info">
          <img src="${coin.image}" alt="${coin.name}" />
          <div class="asset-names">
            <span class="asset-name">${coin.name}</span>
            <span class="asset-symbol">${coin.symbol.toUpperCase()}</span>
          </div>
        </div>
        <div class="asset-values">
          <div class="price">${coin.current_price.toFixed(2)}</div>
          <div class="${changeClass}">${coin.price_change_percentage_24h.toFixed(2)}%</div>
        </div>
      `;
      walletList.appendChild(item);
    });
  }

  fetchCoins();
  setInterval(fetchCoins, 10000);
});

</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach((alert) => {
      setTimeout(() => {
        let bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
        bsAlert.close(); // Bootstrapâ€™s built-in dismiss
      }, 3000); // 3 seconds
    });
  });
</script>



</body>
</html>